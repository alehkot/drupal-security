<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Drupal Security : Pieces of advice on how-to mitigate attacks on Drupal websites.">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Drupal Security</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/alehkot/drupal-security">View on GitHub</a>

          <h1 id="project_title">Drupal Security</h1>
          <h2 id="project_tagline">Pieces of advice on how-to mitigate attacks on Drupal websites.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/alehkot/drupal-security/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/alehkot/drupal-security/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="drupal-security" class="anchor" href="#drupal-security"><span class="octicon octicon-link"></span></a>Drupal Security</h1>

<p>Pieces of advice on how-to improve the security on your Drupal websites.</p>

<h2>
<a name="hiding-traits-of-drupal" class="anchor" href="#hiding-traits-of-drupal"><span class="octicon octicon-link"></span></a>Hiding traits of Drupal</h2>

<p>To secure your a website from automated attacks it always better to hide the CMS:</p>

<ul>
<li>By removing CHANGELOG.txt file;</li>
<li>By removing GENERATOR meta-tag (e.g. using <a href="https://www.drupal.org/project/remove_generator">https://www.drupal.org/project/remove_generator</a> module);</li>
<li>By hiding PHP fatal errors  (e.g. using <a href="https://www.drupal.org/project/hide_php_fatal_error">https://www.drupal.org/project/hide_php_fatal_error</a> module);</li>
<li>By renaming admin paths (e.g. using <a href="https://www.drupal.org/project/rename_admin_paths">https://www.drupal.org/project/rename_admin_paths</a> module);</li>
<li>By modifying the template of robots.txt file;</li>
<li>By disallowing viewing of txt files in the core folder;</li>
<li>By modifying Drupal default Expires header;</li>
<li>By renaming default Drupal strings (e.g. using String Overrides module);</li>
<li>By renaming default classes in Drupal theme;</li>
<li>By changing default upload paths;</li>
<li>By creation of custom 403/404 pages;</li>
<li>By removing, renaming and/or updating update.php file;</li>
<li>By removing, renaming and/or updating cron.php file;</li>
<li>By updating default images, e.g. throbber.</li>
</ul>

<h2>
<a name="handling-psa-2014-003-drupalgeddon" class="anchor" href="#handling-psa-2014-003-drupalgeddon"><span class="octicon octicon-link"></span></a>Handling <a href="https://www.drupal.org/PSA-2014-003">PSA-2014-003</a> (Drupalgeddon)</h2>

<ol>
<li>Immediately upgrade to Drupal 7.32, of it’s not possible at least patch the vulnerable function in /includes/database/database.inc file;</li>
<li>Check files integrity using Git status or if not possible using Hacked;</li>
<li>If possible, redeploy the latest version of the code base;</li>
<li>Scan public / private files locations for *.php, *.sh and any other suspicious files. There are some strategies to improve this procedure: for instance, if only images uploads are allowed, then we scan scan for any files other than images;</li>
<li>If the webserver setup is permissive in terms of permissions and users (e.g. Apache user can write anywhere), it will be additionally required to perform audit of the entire server;</li>
<li>Install, Security review, Drupalgeddon, Site Audit contributed modules and execute these modules checks;</li>
<li>If the pages are built using Features module and if allowed, then revert all the features to their original state;</li>
<li>Rebuild the menu executing core ‘menu_rebuild()’ function;</li>
<li>Review the <code>variable</code> table to find any suspicious values. On some installations it might be possible to truncate the table entirely, if Features module is used and if default values of variables are acceptable.</li>
<li>Check the database for new MySQL users, update MySQL passwords and regenerate passwords/tokens for any systems, which are integrated;</li>
<li>Check users’ roles to find if there is a user which have ‘admin’ role;</li>
<li>Check <code>menu_router</code> and <code>users</code> tables for suspicious entries, e.g. with ‘file_put_contents’ callbacks;</li>
<li>Dump the entire website HTML, e.g. using some crawler, and grep for additional parameters in links;</li>
<li>If possible analyze sessions table for logins of admin/advanced users from external IP addresses and check their last login dates.</li>
<li>Analyze Apache Logs for POST keys with strings 'UPDATE', 'INSERT', 'DELETE', ‘?q=node&amp;destination=node’;</li>
<li>Check places in Panels, Blocks, Views where custom PHP snippets might be used, e.g. in custom access rules.</li>
<li>Set another Drupal hash salt in settings.file for passwords generation, reset passwords of all the users and send them new;</li>
<li>Check the database for new MySQL users, update MySQL passwords and regenerate passwords/tokens for any systems, which are integrated;</li>
<li>Set another Drupal hash salt in settings.file for passwords generation, reset passwords of all the users and send them new.</li>
</ol>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Drupal Security maintained by <a href="https://github.com/alehkot">alehkot</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
